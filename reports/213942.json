{
  "id": 213942,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTM5NDI=",
  "url": "https://hackerone.com/reports/213942",
  "title": "Differential \"Show Raw File\" feature exposes generated files to unauthorised users",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2017-03-16T15:41:25.045Z",
  "submitted_at": "2017-03-16T15:41:25.045Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "calvium",
    "url": "/calvium",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 18,
    "url": "https://hackerone.com/phabricator",
    "handle": "phabricator",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [

    ],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Phabricator",
      "twitter_handle": "phabricator",
      "website": "http://phacility.com/phabricator/",
      "about": "Phabricator is a collection of open source web applications that help software companies build better software."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [

  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2017-03-16T17:32:45.698Z",
  "bug_reporter_agreed_on_going_public_at": "2017-03-16T17:32:45.663Z",
  "team_member_agreed_on_going_public_at": "2017-03-16T17:13:06.241Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Summary:\nIn certain circumstances, a user or mongoose can see a file from a diff they should not be able to see due to a policy.\n\nPreface:\nWe are an app agency using a private Phabricator instance to manage projects. This issue prevents us from allowing clients to access our instance as they would have the ability to see some confidential content for other clients. Spaces and policies seem to work fine other than this issue.\n\nVideo:\nAttached is a <8 min video where I show the issue on a fresh Phabricator installation. The first 6 mins is preparation. The issue is visible in the last 30 seconds.\n\nYou will see I look up ID of the generated file in the database to speed up the demonstration. We could scan through pages automatically with a script to make this bug more viable.\n\nReproduction steps:\n- Open two different browsers (to simulate two different users)\n- BROWSER 1: Log in as a user\n- BROWSER B: Log in as another user\n- BROWSER 1: Go to differential and create a new diff. Make it visible to just yourself\n- BROWSER 1: Update the diff a few times (I've seen the bug more reproducible when the diff is long and the update weaves in changes throughout the file, though this may not actually be a factor)\n- BROWSER B: Visit the diff page, see it is restricted and you cannot see it.\n- BROWSER 1: On the diff page, click \"View Options\" > \"Show Raw File (Right)\". This generates a File.\n- BROWSER B: Start guessing file number pages (this could be done automatically).\n- BROWSER B: Eventually you will hit the file number of the new file and can see the private diff from BROWSER 1.\n\nExpected result:\n- The file generated by Phabricator while comparing diffs should not be accessible. It is not inheriting any policy.\n\nActual result:\n- BROWSER B can download the content of the file, seeing a private diff.\n\nConclusion:\nWe have over 80,000 files in our Phabricator instance from 10s of projects from various clients. If we share our instance with a client that is either malicious or naive in keeping their credentials secure, we would expose some of our other clients code as a consequence of using the \"Show Raw File\" feature.\n\nThanks\nMatt Votsikas\nCalvium Ltd",
  "weakness": {
    "id": 18,
    "name": "Information Disclosure"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 169337,
      "file_name": "show-raw-file.mp4",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/169/337/731de1c25e3dea3213d59364938d1ee47f99a3ba/show-raw-file.mp4?response-content-disposition=attachment%3B%20filename%3D%22show-raw-file.mp4%22%3B%20filename%2A%3DUTF-8%27%27show-raw-file.mp4&response-content-type=video%2Fmp4&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSVJ6PJE2%2F20230923%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230923T080849Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDAaCXVzLXdlc3QtMiJHMEUCIQCdLgw8eKWGkCa72zYJOsj10dlQhNQU3nzhxSluXP9HoAIgOVP7TjyR37bB7wyWj6Y5IirRIT7Nx1frrn%2BaOcmsCcYqsgUIKRADGgwwMTM2MTkyNzQ4NDkiDAyBOuu76gSxYU8fMiqPBVKvdsS1WtBWr4y1jP6sQiSLzEmIYtSCyZLEP3%2FnPQIdIbdrM9ApMRQW4FdQAzEzwYAzlgKtl2fgxaLWREoX%2B0yjaxDYGhrolQX5MShmmAs6nJ9GbqXPcRDtJ6glJGJiDdVd91kwqc6VPd3Lx2qyCiA%2FPnUfMrsymieBFqjw5I6d0ZKQULqT%2BZRdsEFh8iyxaDXMGfC1AzBRFSv6KLcEnZCU8MshcMK7WRo%2B7WzL7HmefViCVYrn01SEqFwNyxFNJG6XTITaCjgeb04tKnvHO86RyTUJVEB0UKcSSM5nXdAjXScKpJZFjN8Frl%2FXmm%2BeMtIaGPiG2X%2BVhBhoa4gnIRC4z3Da7wm%2FX6TiyumAk2bbxf7m5xr%2BNqZa1iWMvcsF4Mr2o6BJV5CqWq9%2FQkl0iPucMZNI%2Fvyafq95nhDwy%2BXxr%2B%2BbRl8AzDoJt8A1%2BLbs5hwrIHww3AqCz%2FD9uodcGBphk5pjXdgCYjd74BJn9dABfy8RXa5aXefS6QJtHel6wV%2F9ahBj33cvu1j85PwnOr5wHvEhoyIycAD%2BZArkm%2Bp7VCor7Ro6umJwSLkQ0M%2FCNrG50ECWUWKyJwjGLfG0%2Bp%2FXkcaJz9f46TdwvclU2lKNeXsAGpwgla4Ns2xFbIz2YilSh4lgCqjsQQkDtWA%2Fc9r9YK3hHbY2BrFpwA6kK48TTU7%2BQi36vM%2FeiJB7gSkwvKcC1a1wMU%2BWGOnP%2FTlG%2BUSyEfhN3ukV1UfmXsQdlQpJLtv2h%2BDM7jfYc7K4VoF%2BKGo%2Be8uarm61pinNCfT99EtsVH1UtYgELfvOzeuObRhvVwVWnmMOwz%2FSNmKI7lvYSEfeXPjdDIgcZ6tEbMjYANEVG3NEAD6cF7K5klGIwTIwsq26qAY6sQEJi2t1uvdTQ9jQRpHAtw1KkGZxi56zNAFyAZ0W%2FkoWCO9%2FP7LbZ8s447xB%2B%2F2iRM95aTQ2TkhMUjw0z3AHTtXnlHEa5ELjlm8aaY4jL6%2BQYLlA%2FrYCmWpiGwbhYA%2FUO1Jr6mfmW6JwaZE57ix01sI2nUiMLxz%2FnpX%2FhvIUZZB%2BT%2BvC5BljGqlWyNJSrvXtrQheqFRN6ScNjQH9sj7eaIv2QLTIHdDGxBTLYAjqv9Dn6ek%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=6d3c964355bcaa029178cbd00b8fafaefa729aa64e9aa5cdd4fc16833a4a5339",
      "file_size": 19707455,
      "type": "video/mp4",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2017-04-15T17:13:06.284Z",
  "allow_singular_disclosure_after": -203180143.43367302,
  "singular_disclosure_allowed": true,
  "vote_count": 10,
  "voters": [
    "bogdantcaciuc",
    "michiel",
    "mdv",
    "eveeez",
    "cyberunit",
    "sumit7",
    "spetr0x",
    "jaimin",
    "arice",
    "b42f97eb69dddcafe5cc278"
  ],
  "severity": {
    "rating": "medium",
    "score": 4.8,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "high",
      "privileges_required": "low",
      "user_interaction": "required",
      "scope": "unchanged",
      "confidentiality": "high",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [

    ],
    "assignable_team_member_groups": [

    ]
  },
  "activities": [
    {
      "id": 1545757,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Thanks for the report! I believe this change will fix the issue you've identified:\n\nhttps://secure.phabricator.com/D17504\n\nI'll follow up once that gets reviewed.\n\nThe change makes us write files with narrow permissions (instead of broad permissions), write temporary files (instead of permanent files) and deletes all of the files which were previously written by older versions of Phabricator on this workflow.",
      "automated_response": false,
      "created_at": "2017-03-16T16:21:10.610Z",
      "updated_at": "2017-03-16T16:21:10.610Z",
      "actor": {
        "username": "epriestley",
        "cleared": false,
        "verified": false,
        "url": "/epriestley",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545768,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Thanks for the (very) quick response, much appreciated.",
      "automated_response": false,
      "created_at": "2017-03-16T16:25:35.324Z",
      "updated_at": "2017-03-16T16:25:35.324Z",
      "actor": {
        "username": "calvium",
        "cleared": false,
        "verified": false,
        "url": "/calvium",
        "profile_picture_urls": {
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545881,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "This fix is now available on `master` and `stable`:\n\nhttps://secure.phabricator.com/rP7626ec0ce10e5a9665d84622259e073744c9872d\nhttps://secure.phabricator.com/rP6f879559707c57006a1a95d839e2e2e6c64a5ff6\n\nSee here for discussion:\n\nhttps://secure.phabricator.com/T12408\n\nWe'll also publish this in the \"Security\" section of the weekly changelog in about 36 hours.\n",
      "automated_response": false,
      "created_at": "2017-03-16T17:08:54.270Z",
      "updated_at": "2017-03-16T17:08:54.270Z",
      "actor": {
        "username": "epriestley",
        "cleared": false,
        "verified": false,
        "url": "/epriestley",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545883,
      "is_internal": false,
      "editable": false,
      "type": "Activities::BugResolved",
      "message": "Per above, I believe this is now resolved.",
      "automated_response": false,
      "created_at": "2017-03-16T17:09:22.168Z",
      "updated_at": "2017-03-16T17:09:22.168Z",
      "actor": {
        "username": "epriestley",
        "cleared": false,
        "verified": false,
        "url": "/epriestley",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "reporter": {
        "username": "calvium",
        "url": "/calvium"
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545899,
      "is_internal": false,
      "editable": false,
      "type": "Activities::BountyAwarded",
      "message": "This is a potentially serious information disclosure vulnerability, tempered by the need to have an account and the difficulty of performing a targeted attack without some additional social engineering (convincing a privileged user to \"Show Raw File\" on a privileged file, on a revision the attacker can't see).",
      "automated_response": false,
      "created_at": "2017-03-16T17:12:41.078Z",
      "updated_at": "2017-03-16T17:12:41.078Z",
      "actor": {
        "url": "/phabricator",
        "ibb": true,
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
        },
        "profile": {
          "name": "Phabricator"
        }
      },
      "bounty_currency": "usd",
      "genius_execution_id": null,
      "team_handle": "phabricator",
      "collaborator": {
        "username": "calvium",
        "url": "/calvium"
      }
    },
    {
      "id": 1545902,
      "is_internal": false,
      "editable": false,
      "type": "Activities::AgreedOnGoingPublic",
      "message": "Details are available in the upstream and commit history, so this can be disclosed at any time.",
      "automated_response": false,
      "created_at": "2017-03-16T17:13:06.257Z",
      "updated_at": "2017-03-16T17:13:06.257Z",
      "first_to_agree": true,
      "actor": {
        "username": "epriestley",
        "cleared": false,
        "verified": false,
        "url": "/epriestley",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545905,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Thanks again! Let us know if you catch any remaining issues after upgrading, or it looks like I missed anything with the patch. And let us know if you run into anything else.",
      "automated_response": false,
      "created_at": "2017-03-16T17:13:32.122Z",
      "updated_at": "2017-03-16T17:13:32.122Z",
      "actor": {
        "username": "epriestley",
        "cleared": false,
        "verified": false,
        "url": "/epriestley",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545924,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Thanks. The team here are amazed at how fast the response and fix was! ",
      "automated_response": false,
      "created_at": "2017-03-16T17:20:09.139Z",
      "updated_at": "2017-03-16T17:20:09.139Z",
      "actor": {
        "username": "calvium",
        "cleared": false,
        "verified": false,
        "url": "/calvium",
        "profile_picture_urls": {
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545964,
      "is_internal": false,
      "editable": false,
      "type": "Activities::AgreedOnGoingPublic",
      "message": "",
      "automated_response": false,
      "created_at": "2017-03-16T17:32:45.679Z",
      "updated_at": "2017-03-16T17:32:45.679Z",
      "actor": {
        "username": "calvium",
        "cleared": false,
        "verified": false,
        "url": "/calvium",
        "profile_picture_urls": {
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    },
    {
      "id": 1545965,
      "is_internal": false,
      "editable": false,
      "type": "Activities::ReportBecamePublic",
      "message": "",
      "automated_response": false,
      "created_at": "2017-03-16T17:32:45.714Z",
      "updated_at": "2017-03-16T17:32:45.714Z",
      "actor": {
        "username": "calvium",
        "cleared": false,
        "verified": false,
        "url": "/calvium",
        "profile_picture_urls": {
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "phabricator"
    }
  ],
  "activity_page_count": 1,
  "activity_page_number": 1,
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}