{
  "id": 532667,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MzI2Njc=",
  "url": "https://hackerone.com/reports/532667",
  "title": "Server Side JavaScript Code Injection",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "high",
  "readable_substate": "Resolved",
  "created_at": "2019-04-09T15:23:13.508Z",
  "submitted_at": "2019-04-09T15:23:13.508Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "phra",
    "url": "/phra",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/ede8cd84a64d5392a2bb88ecb598721116469c27c015c2caa77148f11e211d58"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 23949,
    "url": "https://hackerone.com/nodejs-ecosystem",
    "handle": "nodejs-ecosystem",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [

    ],
    "submission_state": "disabled",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Node.js third-party modules",
      "twitter_handle": "",
      "website": "https://nodejs.org/en/security/",
      "about": "This program was used to handle vulnerabilities in the Node.js ecosystem."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [

  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-10-03T18:17:41.756Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2019-09-03T18:17:32.418Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "I would like to report a Service Side JavaScript Code Injection in `fastify`.\nIt allows an attacker that can control a single property name in the serialization schema to achieve Remote Command Execution in the context of the web server.\n\n# Module\n\n**module name:** fastify\n**version:** 2.2.0\n**npm page:** `https://www.npmjs.com/package/fastify`\n\n## Module Description\n\n> An efficient server implies a lower cost of the infrastructure, a better responsiveness under load and happy users. How can you efficiently handle the resources of your server, knowing that you are serving the highest number of requests as possible, without sacrificing security validations and handy development? Enter Fastify. Fastify is a web framework highly focused on providing the best developer experience with the least overhead and a powerful plugin architecture. It is inspired by Hapi and Express and as far as we know, it is one of the fastest web frameworks in town.\n\n## Module Stats\n\n39,119 downloads in the last week\n\n# Vulnerability\n\n## Vulnerability Description\n\n> Description about how the vulnerability was found and how it can be exploited, how it harms package users (data modification/lost, system access, other.\n\n## Steps To Reproduce:\n\n> Detailed steps to reproduce with all required references/steps/commands. If there is any exploit code or reference to the package source code this is the place where it should be put.\n\n## Patch\n\nEscape `\"`, `'` and ``` ` ``` in properties names in schema definition.\n\n## Supporting Material/References:\n\n> State all technical information about the stack where the vulnerability was found\n\n- **OS:** Kali Rolling\n- **NodeJS:** 11.9\n- **NPM:** 6.5.0\n- **fast-json-stringify:** 1.14.0\n\n# Wrap up\n\n> Select Y or N for the following statements:\n\n- I contacted the maintainer to let them know: Y (sent message to Matteo Collina)\n- I opened an issue in the related repository: N\n\n## Impact\n\nIf an attacker can control somehow the schema definition, he/she can achieve arbitrary code execution as the user running the web server.",
  "weakness": {
    "id": 70,
    "name": "Code Injection"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 465338,
      "file_name": "poc-fast-json-stringify.js",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/465/338/26bb244a589abb4bcfefb84b7fa411b7c0660f76/poc-fast-json-stringify.js?response-content-disposition=attachment%3B%20filename%3D%22poc-fast-json-stringify.js%22%3B%20filename%2A%3DUTF-8%27%27poc-fast-json-stringify.js&response-content-type=text%2Fplain&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ5NIKTYBN%2F20230923%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230923T073514Z&X-Amz-Expires=992&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECoaCXVzLXdlc3QtMiJHMEUCIQCM2la1GSZwFkbzZwAlaXr0SDHvL7evb0H8C%2BcAyp6rJwIgUS%2FvPViGx2g0I162nhXzz0XdF2Xh43GEuLX0y03wgpgqsgUIIxADGgwwMTM2MTkyNzQ4NDkiDNqaUM2zKa0nRrRjPiqPBY3HR7dtjU%2FqgV%2Bme1Vi2BF0srTbVHaeVx7AXFxoOny%2FWf6dy0NtyNi5jqQtZSPTNusRUoRBEVYluoE2pTzC4h8vkvORrE9JykyZYTHH8ocgk5lc0APz3GbNdw8EDi7TxEfkQrfeNcb9De%2FCYblR%2BcD3eIOuf0HhbFpNONPshVMD2bahKYX2YefU56UpZ3VXRBwPkoVPMgab%2BFva6rLt69nWaBZT3wd3EIEFt5XoYZDHjSKORRTdwTs%2FDCgqPEoyGhV0VrhBCUYqQbAukt7wGk7NrNDWs7mZmkL9Kv28fQIY1Q7h9exaudTPtQP0E2yZtr3wKCcWNQFiX57yas%2B0bvmeuA3ym%2BSzBLvdO1P9ziA8htBG3pApMoYNVRcJXqB9Ulg7ZaIeoGHU8ucHynNO64xiJkECfQ%2F83m0uusP%2FCbg8v%2FC8x09sz0WJsbCM5h90DddiMkeTK%2B47Ho2K%2FzWj9Vax4pTTeyBAgNycvbE1C5SdrAIC8ofvTBgjD9VJnS4%2Fm%2FaSERgD%2FpHxyUa3F9f2xwK2zzZHVjSUL9gImPRAlJZ6Nh8ldRy7Y8qAeEkVVgxlkabpkSUzkeJFYWeyAIFxnGiALPstIyZO91J3sBSrtYKPCa81FT%2BAe5FdP%2F16dX7M8G2QBoHlOCiborPNR188kYqbrtspQiMLdSdCqE06hDUFQ3PcbE8pZjc3H5dcny%2BqL2xr08qLnFp5WdXxcvFRdgKAOAiyBUtpuXF6qITm0ms7xwUQpzSFqpQFGxJNdqYxaBQFXFr1B8dripk5f1Qg734MxZRFa8OXrC0SUBclX%2FIsJJJqUWr7uq4q66njtMMLeKaRxJh4vXuOMKGmNrytwHC7GauHczb7gJBY9EaCQsEwyfu4qAY6sQHEE5yo4qz1nHc7W%2FmuNCkeiEC06BT2KXW5Ye7wR%2BJRqa4RD1Evl5MaAbKYOUm3j3RKv8ZiQXgBRIDsjMyLkeHJDlM30wkC5GTlhwpLfAXvVAeC%2BGlwLLBvL176VeFL7S7mGPxQhRCLoa8DCYKS9rPurVlp6T5EPeBgnNUxOC0WTs38l8ylcSgu2HURNvrOIIHuAxsNQYx%2Bnc4wcFv0RnkFptS7LlYhwcWV%2FKYEjxiy5O8%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=c92ebf205e6220779ecc96cd28f8d48bf0d9f1a7274fb66114d8bfc11d3648f9",
      "file_size": 2861,
      "type": "text/plain",
      "moderated": null
    },
    {
      "id": 465339,
      "file_name": "poc-fastify.js",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/465/339/93f50fa838e2f110e76965f37c5b485ab16aba63/poc-fastify.js?response-content-disposition=attachment%3B%20filename%3D%22poc-fastify.js%22%3B%20filename%2A%3DUTF-8%27%27poc-fastify.js&response-content-type=text%2Fplain&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ5NIKTYBN%2F20230923%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230923T073514Z&X-Amz-Expires=992&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECoaCXVzLXdlc3QtMiJHMEUCIQCM2la1GSZwFkbzZwAlaXr0SDHvL7evb0H8C%2BcAyp6rJwIgUS%2FvPViGx2g0I162nhXzz0XdF2Xh43GEuLX0y03wgpgqsgUIIxADGgwwMTM2MTkyNzQ4NDkiDNqaUM2zKa0nRrRjPiqPBY3HR7dtjU%2FqgV%2Bme1Vi2BF0srTbVHaeVx7AXFxoOny%2FWf6dy0NtyNi5jqQtZSPTNusRUoRBEVYluoE2pTzC4h8vkvORrE9JykyZYTHH8ocgk5lc0APz3GbNdw8EDi7TxEfkQrfeNcb9De%2FCYblR%2BcD3eIOuf0HhbFpNONPshVMD2bahKYX2YefU56UpZ3VXRBwPkoVPMgab%2BFva6rLt69nWaBZT3wd3EIEFt5XoYZDHjSKORRTdwTs%2FDCgqPEoyGhV0VrhBCUYqQbAukt7wGk7NrNDWs7mZmkL9Kv28fQIY1Q7h9exaudTPtQP0E2yZtr3wKCcWNQFiX57yas%2B0bvmeuA3ym%2BSzBLvdO1P9ziA8htBG3pApMoYNVRcJXqB9Ulg7ZaIeoGHU8ucHynNO64xiJkECfQ%2F83m0uusP%2FCbg8v%2FC8x09sz0WJsbCM5h90DddiMkeTK%2B47Ho2K%2FzWj9Vax4pTTeyBAgNycvbE1C5SdrAIC8ofvTBgjD9VJnS4%2Fm%2FaSERgD%2FpHxyUa3F9f2xwK2zzZHVjSUL9gImPRAlJZ6Nh8ldRy7Y8qAeEkVVgxlkabpkSUzkeJFYWeyAIFxnGiALPstIyZO91J3sBSrtYKPCa81FT%2BAe5FdP%2F16dX7M8G2QBoHlOCiborPNR188kYqbrtspQiMLdSdCqE06hDUFQ3PcbE8pZjc3H5dcny%2BqL2xr08qLnFp5WdXxcvFRdgKAOAiyBUtpuXF6qITm0ms7xwUQpzSFqpQFGxJNdqYxaBQFXFr1B8dripk5f1Qg734MxZRFa8OXrC0SUBclX%2FIsJJJqUWr7uq4q66njtMMLeKaRxJh4vXuOMKGmNrytwHC7GauHczb7gJBY9EaCQsEwyfu4qAY6sQHEE5yo4qz1nHc7W%2FmuNCkeiEC06BT2KXW5Ye7wR%2BJRqa4RD1Evl5MaAbKYOUm3j3RKv8ZiQXgBRIDsjMyLkeHJDlM30wkC5GTlhwpLfAXvVAeC%2BGlwLLBvL176VeFL7S7mGPxQhRCLoa8DCYKS9rPurVlp6T5EPeBgnNUxOC0WTs38l8ylcSgu2HURNvrOIIHuAxsNQYx%2Bnc4wcFv0RnkFptS7LlYhwcWV%2FKYEjxiy5O8%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=db74f0596b51ca129f2fc2851d2afe5bb0ece2f8119bb020d9ed67bb3522a555",
      "file_size": 2008,
      "type": "text/plain",
      "moderated": null
    },
    {
      "id": 465341,
      "file_name": "proof.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/465/341/04882000450ebc5083fc5289a7c7b0a62a87a26c/proof.png?response-content-disposition=attachment%3B%20filename%3D%22proof.png%22%3B%20filename%2A%3DUTF-8%27%27proof.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ5NIKTYBN%2F20230923%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230923T073514Z&X-Amz-Expires=992&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECoaCXVzLXdlc3QtMiJHMEUCIQCM2la1GSZwFkbzZwAlaXr0SDHvL7evb0H8C%2BcAyp6rJwIgUS%2FvPViGx2g0I162nhXzz0XdF2Xh43GEuLX0y03wgpgqsgUIIxADGgwwMTM2MTkyNzQ4NDkiDNqaUM2zKa0nRrRjPiqPBY3HR7dtjU%2FqgV%2Bme1Vi2BF0srTbVHaeVx7AXFxoOny%2FWf6dy0NtyNi5jqQtZSPTNusRUoRBEVYluoE2pTzC4h8vkvORrE9JykyZYTHH8ocgk5lc0APz3GbNdw8EDi7TxEfkQrfeNcb9De%2FCYblR%2BcD3eIOuf0HhbFpNONPshVMD2bahKYX2YefU56UpZ3VXRBwPkoVPMgab%2BFva6rLt69nWaBZT3wd3EIEFt5XoYZDHjSKORRTdwTs%2FDCgqPEoyGhV0VrhBCUYqQbAukt7wGk7NrNDWs7mZmkL9Kv28fQIY1Q7h9exaudTPtQP0E2yZtr3wKCcWNQFiX57yas%2B0bvmeuA3ym%2BSzBLvdO1P9ziA8htBG3pApMoYNVRcJXqB9Ulg7ZaIeoGHU8ucHynNO64xiJkECfQ%2F83m0uusP%2FCbg8v%2FC8x09sz0WJsbCM5h90DddiMkeTK%2B47Ho2K%2FzWj9Vax4pTTeyBAgNycvbE1C5SdrAIC8ofvTBgjD9VJnS4%2Fm%2FaSERgD%2FpHxyUa3F9f2xwK2zzZHVjSUL9gImPRAlJZ6Nh8ldRy7Y8qAeEkVVgxlkabpkSUzkeJFYWeyAIFxnGiALPstIyZO91J3sBSrtYKPCa81FT%2BAe5FdP%2F16dX7M8G2QBoHlOCiborPNR188kYqbrtspQiMLdSdCqE06hDUFQ3PcbE8pZjc3H5dcny%2BqL2xr08qLnFp5WdXxcvFRdgKAOAiyBUtpuXF6qITm0ms7xwUQpzSFqpQFGxJNdqYxaBQFXFr1B8dripk5f1Qg734MxZRFa8OXrC0SUBclX%2FIsJJJqUWr7uq4q66njtMMLeKaRxJh4vXuOMKGmNrytwHC7GauHczb7gJBY9EaCQsEwyfu4qAY6sQHEE5yo4qz1nHc7W%2FmuNCkeiEC06BT2KXW5Ye7wR%2BJRqa4RD1Evl5MaAbKYOUm3j3RKv8ZiQXgBRIDsjMyLkeHJDlM30wkC5GTlhwpLfAXvVAeC%2BGlwLLBvL176VeFL7S7mGPxQhRCLoa8DCYKS9rPurVlp6T5EPeBgnNUxOC0WTs38l8ylcSgu2HURNvrOIIHuAxsNQYx%2Bnc4wcFv0RnkFptS7LlYhwcWV%2FKYEjxiy5O8%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=a2f5a1321688140dc0824cbb1ba13da6fbb0db5d9594322e39f1c7119a2491b7",
      "file_size": 108983,
      "type": "image/png",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2019-10-03T18:17:32.893Z",
  "allow_singular_disclosure_after": -125327861.3223892,
  "singular_disclosure_allowed": true,
  "vote_count": 10,
  "voters": [
    "yxw21",
    "bl4de",
    "mik317",
    "eveeez",
    "0x08",
    "armansameer",
    "d4vinci",
    "fingerling",
    "yoflow",
    "herlock-momo"
  ],
  "severity": {
    "rating": "high",
    "author_type": "User"
  },
  "structured_scope": {
    "databaseId": 4647,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "fastify",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [

    ],
    "assignable_team_member_groups": [

    ]
  },
  "activities": [
    {
      "id": 4519319,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Hello,\nThanks for reporting this to us. Someone will quickly look at this report and triage it.",
      "automated_response": true,
      "created_at": "2019-04-09T15:23:19.262Z",
      "updated_at": "2019-04-09T15:23:19.262Z",
      "actor": {
        "username": "vdeturckheim_dev",
        "cleared": false,
        "verified": false,
        "url": "/vdeturckheim_dev",
        "profile_picture_urls": {
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4519343,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "# Vulnerability\n\n## Description\n`fastify` is using `fast-json-stingify` to serialize data in the response. This library is vulnerable to Server Side Code Injection, as shown in the attached poc. The only constrain for the attacker is to be able to control a field name in the schema definition.\n\n## Steps To Reproduce:\n- Run the attached `vuln-server.js`\n`nodepoc-fastify.js`\n\n- Prepare netcat on port 1337:\n`nc -lvvp 1337`\n\n- Send GET request to the server:\n`curl 127.0.0.1`",
      "automated_response": false,
      "created_at": "2019-04-09T15:28:02.863Z",
      "updated_at": "2019-04-09T15:35:59.004Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "attachments": [
        {
          "id": 465354,
          "filename": "vuln-server.js",
          "type": "text/plain",
          "url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/465/354/4631fc96b5c769e9231e8e107abd36dbfff8fac4/vuln-server.js?response-content-disposition=attachment%3B%20filename%3D%22vuln-server.js%22%3B%20filename%2A%3DUTF-8%27%27vuln-server.js&response-content-type=text%2Fplain&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ5NIKTYBN%2F20230923%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230923T073514Z&X-Amz-Expires=992&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECoaCXVzLXdlc3QtMiJHMEUCIQCM2la1GSZwFkbzZwAlaXr0SDHvL7evb0H8C%2BcAyp6rJwIgUS%2FvPViGx2g0I162nhXzz0XdF2Xh43GEuLX0y03wgpgqsgUIIxADGgwwMTM2MTkyNzQ4NDkiDNqaUM2zKa0nRrRjPiqPBY3HR7dtjU%2FqgV%2Bme1Vi2BF0srTbVHaeVx7AXFxoOny%2FWf6dy0NtyNi5jqQtZSPTNusRUoRBEVYluoE2pTzC4h8vkvORrE9JykyZYTHH8ocgk5lc0APz3GbNdw8EDi7TxEfkQrfeNcb9De%2FCYblR%2BcD3eIOuf0HhbFpNONPshVMD2bahKYX2YefU56UpZ3VXRBwPkoVPMgab%2BFva6rLt69nWaBZT3wd3EIEFt5XoYZDHjSKORRTdwTs%2FDCgqPEoyGhV0VrhBCUYqQbAukt7wGk7NrNDWs7mZmkL9Kv28fQIY1Q7h9exaudTPtQP0E2yZtr3wKCcWNQFiX57yas%2B0bvmeuA3ym%2BSzBLvdO1P9ziA8htBG3pApMoYNVRcJXqB9Ulg7ZaIeoGHU8ucHynNO64xiJkECfQ%2F83m0uusP%2FCbg8v%2FC8x09sz0WJsbCM5h90DddiMkeTK%2B47Ho2K%2FzWj9Vax4pTTeyBAgNycvbE1C5SdrAIC8ofvTBgjD9VJnS4%2Fm%2FaSERgD%2FpHxyUa3F9f2xwK2zzZHVjSUL9gImPRAlJZ6Nh8ldRy7Y8qAeEkVVgxlkabpkSUzkeJFYWeyAIFxnGiALPstIyZO91J3sBSrtYKPCa81FT%2BAe5FdP%2F16dX7M8G2QBoHlOCiborPNR188kYqbrtspQiMLdSdCqE06hDUFQ3PcbE8pZjc3H5dcny%2BqL2xr08qLnFp5WdXxcvFRdgKAOAiyBUtpuXF6qITm0ms7xwUQpzSFqpQFGxJNdqYxaBQFXFr1B8dripk5f1Qg734MxZRFa8OXrC0SUBclX%2FIsJJJqUWr7uq4q66njtMMLeKaRxJh4vXuOMKGmNrytwHC7GauHczb7gJBY9EaCQsEwyfu4qAY6sQHEE5yo4qz1nHc7W%2FmuNCkeiEC06BT2KXW5Ye7wR%2BJRqa4RD1Evl5MaAbKYOUm3j3RKv8ZiQXgBRIDsjMyLkeHJDlM30wkC5GTlhwpLfAXvVAeC%2BGlwLLBvL176VeFL7S7mGPxQhRCLoa8DCYKS9rPurVlp6T5EPeBgnNUxOC0WTs38l8ylcSgu2HURNvrOIIHuAxsNQYx%2Bnc4wcFv0RnkFptS7LlYhwcWV%2FKYEjxiy5O8%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=e07e6814f66a0762a90f884bc87793d6f05e87d12e5835bbbfdf17a93a551dcb"
        }
      ],
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4519440,
      "is_internal": false,
      "editable": false,
      "type": "Activities::ExternalUserJoined",
      "message": "",
      "automated_response": false,
      "created_at": "2019-04-09T15:36:07.023Z",
      "updated_at": "2019-04-09T15:36:07.023Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4519459,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "I added @mcollina to the report.",
      "automated_response": false,
      "created_at": "2019-04-09T15:38:58.582Z",
      "updated_at": "2019-04-09T15:38:58.582Z",
      "actor": {
        "username": "vdeturckheim",
        "cleared": false,
        "verified": false,
        "url": "/vdeturckheim",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/161/010/6f383ac0f9296c13b5ac0d38741f0685dbace58c_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4531152,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "I tried to patch the vulnerable library `fast-json-stringify` but I had hard time with it due to the fact that is a single file of ~1K lines and multiple points have to be updated without breaking the intended functionality.\nThe input is reflected 4 times in the generated script, as shown in the attached screenshot.\nIt would be nice if someone could help with fixing the library.",
      "automated_response": false,
      "created_at": "2019-04-10T15:31:47.308Z",
      "updated_at": "2019-04-10T15:31:47.308Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "attachments": [
        {
          "id": 466158,
          "filename": "reflections.png",
          "type": "image/png",
          "url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/466/158/67802158cae0df141cebc163a1250f4caab3fb04/reflections.png?response-content-disposition=attachment%3B%20filename%3D%22reflections.png%22%3B%20filename%2A%3DUTF-8%27%27reflections.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ5NIKTYBN%2F20230923%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230923T073514Z&X-Amz-Expires=992&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECoaCXVzLXdlc3QtMiJHMEUCIQCM2la1GSZwFkbzZwAlaXr0SDHvL7evb0H8C%2BcAyp6rJwIgUS%2FvPViGx2g0I162nhXzz0XdF2Xh43GEuLX0y03wgpgqsgUIIxADGgwwMTM2MTkyNzQ4NDkiDNqaUM2zKa0nRrRjPiqPBY3HR7dtjU%2FqgV%2Bme1Vi2BF0srTbVHaeVx7AXFxoOny%2FWf6dy0NtyNi5jqQtZSPTNusRUoRBEVYluoE2pTzC4h8vkvORrE9JykyZYTHH8ocgk5lc0APz3GbNdw8EDi7TxEfkQrfeNcb9De%2FCYblR%2BcD3eIOuf0HhbFpNONPshVMD2bahKYX2YefU56UpZ3VXRBwPkoVPMgab%2BFva6rLt69nWaBZT3wd3EIEFt5XoYZDHjSKORRTdwTs%2FDCgqPEoyGhV0VrhBCUYqQbAukt7wGk7NrNDWs7mZmkL9Kv28fQIY1Q7h9exaudTPtQP0E2yZtr3wKCcWNQFiX57yas%2B0bvmeuA3ym%2BSzBLvdO1P9ziA8htBG3pApMoYNVRcJXqB9Ulg7ZaIeoGHU8ucHynNO64xiJkECfQ%2F83m0uusP%2FCbg8v%2FC8x09sz0WJsbCM5h90DddiMkeTK%2B47Ho2K%2FzWj9Vax4pTTeyBAgNycvbE1C5SdrAIC8ofvTBgjD9VJnS4%2Fm%2FaSERgD%2FpHxyUa3F9f2xwK2zzZHVjSUL9gImPRAlJZ6Nh8ldRy7Y8qAeEkVVgxlkabpkSUzkeJFYWeyAIFxnGiALPstIyZO91J3sBSrtYKPCa81FT%2BAe5FdP%2F16dX7M8G2QBoHlOCiborPNR188kYqbrtspQiMLdSdCqE06hDUFQ3PcbE8pZjc3H5dcny%2BqL2xr08qLnFp5WdXxcvFRdgKAOAiyBUtpuXF6qITm0ms7xwUQpzSFqpQFGxJNdqYxaBQFXFr1B8dripk5f1Qg734MxZRFa8OXrC0SUBclX%2FIsJJJqUWr7uq4q66njtMMLeKaRxJh4vXuOMKGmNrytwHC7GauHczb7gJBY9EaCQsEwyfu4qAY6sQHEE5yo4qz1nHc7W%2FmuNCkeiEC06BT2KXW5Ye7wR%2BJRqa4RD1Evl5MaAbKYOUm3j3RKv8ZiQXgBRIDsjMyLkeHJDlM30wkC5GTlhwpLfAXvVAeC%2BGlwLLBvL176VeFL7S7mGPxQhRCLoa8DCYKS9rPurVlp6T5EPeBgnNUxOC0WTs38l8ylcSgu2HURNvrOIIHuAxsNQYx%2Bnc4wcFv0RnkFptS7LlYhwcWV%2FKYEjxiy5O8%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=3ac6969fcbd2ec314e3f5f1ded935193e498309a6a8add4db14fc1c288334b45"
        }
      ],
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4538690,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "This is not a vulnerability, but just a \"bad\" bug. The scope of fast-json-stringify is to generate a new function that is extremely fast on rendering json. That's what the library is for. Feel free to recommend some more text to explain the functionality and relative danger if used with user-specified data.\n\nIn fastify, it is not possible to set the schema of a route dynamically without modifying the source code. As result, fastify is not vulnerable.\n\n---\n\nWe are happy to land a PR that address this bad bug, if we get one.\n\nAn alternative approach can be to detect this type of patterns instead of sanitizing, and throwing an error in those cases.",
      "automated_response": false,
      "created_at": "2019-04-11T12:08:25.531Z",
      "updated_at": "2019-04-11T12:08:25.531Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4540063,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Hello Matteo,\n\nI am happy to hear that _by default_ it's not possible to (re)define the schema with simple HTTP request.\nHowever, at the moment nothing prevents a _bad_ developer to implement such code (_that should not be vulnerable to arbitrary code execution_) and effectively making the vulnerability exploitable from the network. The fact that some requirement has to be met in order to make the issue exploitable, just lowers the likelihood and risk associated with it, but it's doesn't deprecate the vulnerability to \"bad bug\". Additionally the issue is present in a library used by `fastify`, namely `json-fast-stringify`, that it can be used in other, unintended ways, compared to `fastify` use cases. The ideal solution will be making the issue not exploitable in all the possible scenarios, as marking it as `WONTFIX` will leave this bug dormant.\n\n```javascript\nconst fastify = require('fastify')()\n\nfastify.route({\n  method: 'POST',\n  url: '/create-vulnerable-route',\n  schema: {\n    body: {\n      type: 'object',\n      properties: {\n        greeting: 'greetings#',\n        timestamp: { type: 'number' }\n      },\n      patternProperties: {\n        '.*vuln$': 'string'\n      },\n    }\n  },\n  handler: (request, reply) => {\n      const random = Math.floor(Math.random() * 100)\n      fastify.addSchema({\n        $id: 'greetings',\n        type: 'object',\n        properties: {\n            hello: { type: 'string' }\n        }\n    })\n\n    fastify.route({\n        method: 'POST',\n        url: `/vulnerable-route${random}`,\n        schema: JSON.parse(request.body),\n        handler: () => {}\n    })\n\n    reply.send(`Route /vulnerable-route${random} was successfully created!`)\n  }\n})\n```",
      "automated_response": false,
      "created_at": "2019-04-11T15:41:47.572Z",
      "updated_at": "2019-04-11T15:41:47.572Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4542445,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "The code you provided crash at startup. The following code is closer to what you intended to do, but it crashes as well whenever `route` is called, no response is sent to the server, and fast-json-stringify is not colled.\n\n```js\nconst fastify = require('fastify')()\n\nfastify.route({\n  method: 'POST',\n  url: '/',\n  handler: (request, reply) => {\n    const random = Math.floor(Math.random() * 100)\n\n    fastify.route({\n        method: 'POST',\n        url: `/vulnerable-route${random}`,\n        schema: request.body,\n        handler: () => {}\n    })\n\n    reply.send(`Route /vulnerable-route${random} was successfully created!`)\n  }\n})\n\nfastify.listen(3000)\n```",
      "automated_response": false,
      "created_at": "2019-04-11T19:35:19.514Z",
      "updated_at": "2019-04-11T19:35:19.514Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4542502,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Can you please check if the following solves all cases:\n\n```js\ndiff --git a/index.js b/index.js\nindex b6bbe4f..c33b66e 100644\n--- a/index.js\n+++ b/index.js\n@@ -119,6 +119,8 @@ function build (schema, options) {\n   }\n \n   dependenciesName.push(code)\n+\n+  console.log(code)\n   return (Function.apply(null, dependenciesName).apply(null, dependencies))\n }\n \n@@ -491,6 +493,10 @@ function refFinder (ref, schema, externalSchema) {\n   return (new Function('schema', code))(schema)\n }\n \n+function sanitizeKey (key) {\n+  return key.replace(/([^\\\\])\\'/g, '$1\\\\\\'')\n+}\n+\n function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n   Object.keys(schema.properties || {}).forEach((key, i, a) => {\n     if (schema.properties[key]['$ref']) {\n@@ -502,12 +508,13 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     var type = schema.properties[key].type\n     var nullable = schema.properties[key].nullable\n+    var sanitized = sanitizeKey(key)\n \n     if (nullable) {\n       code += `\n-        if (obj['${key}'] === null) {\n+        if (obj['${sanitized}'] === null) {\n           ${addComma}\n-          json += '${$asString(key)}:null'\n+          json += '${$asString(sanitized)}:null'\n           var rendered = true\n         } else {\n       `\n@@ -515,10 +522,10 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     if (type === 'number') {\n       code += `\n-          var t = Number(obj['${key}'])\n+          var t = Number(obj['${sanitized}'])\n           if (!isNaN(t)) {\n             ${addComma}\n-            json += '${$asString(key)}:' + t\n+            json += '${$asString(sanitized)}:' + t\n       `\n     } else if (type === 'integer') {\n       code += `\n@@ -526,25 +533,25 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n       if (isLong) {\n         code += `\n-            if (isLong(obj['${key}'])) {\n+            if (isLong(obj['${sanitized}'])) {\n               ${addComma}\n-              json += '${$asString(key)}:' + obj['${key}'].toString()\n+              json += '${$asString(sanitized)}:' + obj['${sanitized}'].toString()\n               rendered = true\n             } else {\n-              var t = Number(obj['${key}'])\n+              var t = Number(obj['${sanitized}'])\n               if (!isNaN(t)) {\n                 ${addComma}\n-                json += '${$asString(key)}:' + t\n+                json += '${$asString(sanitized)}:' + t\n                 rendered = true\n               }\n             }\n         `\n       } else {\n         code += `\n-            var t = Number(obj['${key}'])\n+            var t = Number(obj['${sanitized}'])\n             if (!isNaN(t)) {\n               ${addComma}\n-              json += '${$asString(key)}:' + t\n+              json += '${$asString(sanitized)}:' + t\n               rendered = true\n             }\n         `\n@@ -554,7 +561,7 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n     } else {\n       code += `\n-        if (obj['${key}'] !== undefined) {\n+        if (obj['${sanitized}'] !== undefined) {\n           ${addComma}\n           json += '${$asString(key)}:'\n         `\n@@ -569,12 +576,12 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       code += `\n       } else {\n         ${addComma}\n-        json += '${$asString(key)}:${JSON.stringify(defaultValue).replace(/'/g, '\\'')}'\n+        json += '${$asString(sanitized)}:${JSON.stringify(defaultValue).replace(/'/g, '\\'')}'\n       `\n     } else if (schema.required && schema.required.indexOf(key) !== -1) {\n       code += `\n       } else {\n-        throw new Error('${key} is required!')\n+        throw new Error('${sanitized} is required!')\n       `\n     }\n ```",
      "automated_response": false,
      "created_at": "2019-04-11T19:53:34.831Z",
      "updated_at": "2019-04-11T19:53:34.831Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4543674,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "I checked the proposed patch. We are on the right track, but I could identify some other edge cases: (not sure if these are all of them)\n\n- default properties\n\n```javascript\n  properties: {\n      phra: {\n        type: 'string',\n        default: 'a\\'&&(console.log(\\'w00tw00t\\'))||\\''\n      },\n  ...\n```\n\n- pattern properties\n\n```javascript\n  patternProperties: {\n    'phra\\'/ && console.log(\"w00tw00t\") && /\\'': {\n      type: 'number'\n    }\n  },\n````\n\nFor the rest, I am worried about arrays, nested fields and `if/then/else` jsonschema feature (and eventual combinations of these cases) but I don't have a working POC for them.",
      "automated_response": false,
      "created_at": "2019-04-12T00:03:11.281Z",
      "updated_at": "2019-04-12T00:03:11.281Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4545086,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Latest patch, let me know if you can find more.\n\n```js\ndiff --git a/index.js b/index.js\nindex b6bbe4f..f9c9e30 100644\n--- a/index.js\n+++ b/index.js\n@@ -119,6 +119,8 @@ function build (schema, options) {\n   }\n \n   dependenciesName.push(code)\n+\n+  console.log(code)\n   return (Function.apply(null, dependenciesName).apply(null, dependencies))\n }\n \n@@ -301,7 +303,7 @@ function addPatternProperties (schema, externalSchema, fullSchema) {\n     }\n     var type = pp[regex].type\n     code += `\n-        if (/${regex}/.test(keys[i])) {\n+        if (/${regex.replace(/([^\\\\]+\\/)/g, '\\\\/')}/.test(keys[i])) {\n     `\n     if (type === 'object') {\n       code += buildObject(pp[regex], '', 'buildObjectPP' + index, externalSchema, fullSchema)\n@@ -491,6 +493,10 @@ function refFinder (ref, schema, externalSchema) {\n   return (new Function('schema', code))(schema)\n }\n \n+function sanitizeKey (key) {\n+  return key.replace(/([^\\\\])\\'/g, '$1\\\\\\'')\n+}\n+\n function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n   Object.keys(schema.properties || {}).forEach((key, i, a) => {\n     if (schema.properties[key]['$ref']) {\n@@ -502,12 +508,13 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     var type = schema.properties[key].type\n     var nullable = schema.properties[key].nullable\n+    var sanitized = sanitizeKey(key)\n \n     if (nullable) {\n       code += `\n-        if (obj['${key}'] === null) {\n+        if (obj['${sanitized}'] === null) {\n           ${addComma}\n-          json += '${$asString(key)}:null'\n+          json += '${$asString(sanitized)}:null'\n           var rendered = true\n         } else {\n       `\n@@ -515,10 +522,10 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     if (type === 'number') {\n       code += `\n-          var t = Number(obj['${key}'])\n+          var t = Number(obj['${sanitized}'])\n           if (!isNaN(t)) {\n             ${addComma}\n-            json += '${$asString(key)}:' + t\n+            json += '${$asString(sanitized)}:' + t\n       `\n     } else if (type === 'integer') {\n       code += `\n@@ -526,25 +533,25 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n       if (isLong) {\n         code += `\n-            if (isLong(obj['${key}'])) {\n+            if (isLong(obj['${sanitized}'])) {\n               ${addComma}\n-              json += '${$asString(key)}:' + obj['${key}'].toString()\n+              json += '${$asString(sanitized)}:' + obj['${sanitized}'].toString()\n               rendered = true\n             } else {\n-              var t = Number(obj['${key}'])\n+              var t = Number(obj['${sanitized}'])\n               if (!isNaN(t)) {\n                 ${addComma}\n-                json += '${$asString(key)}:' + t\n+                json += '${$asString(sanitized)}:' + t\n                 rendered = true\n               }\n             }\n         `\n       } else {\n         code += `\n-            var t = Number(obj['${key}'])\n+            var t = Number(obj['${sanitized}'])\n             if (!isNaN(t)) {\n               ${addComma}\n-              json += '${$asString(key)}:' + t\n+              json += '${$asString(sanitized)}:' + t\n               rendered = true\n             }\n         `\n@@ -554,7 +561,7 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n     } else {\n       code += `\n-        if (obj['${key}'] !== undefined) {\n+        if (obj['${sanitized}'] !== undefined) {\n           ${addComma}\n           json += '${$asString(key)}:'\n         `\n@@ -569,12 +576,12 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       code += `\n       } else {\n         ${addComma}\n-        json += '${$asString(key)}:${JSON.stringify(defaultValue).replace(/'/g, '\\'')}'\n+        json += '${$asString(sanitized)}:${sanitizeKey(JSON.stringify(defaultValue)).replace(/'/g, '\\'')}'\n       `\n     } else if (schema.required && schema.required.indexOf(key) !== -1) {\n       code += `\n       } else {\n-        throw new Error('${key} is required!')\n+        throw new Error('${sanitized} is required!')\n       `\n     }\n ```",
      "automated_response": false,
      "created_at": "2019-04-12T07:14:49.611Z",
      "updated_at": "2019-04-12T07:14:49.611Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4549261,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "found another one array based.\n\nschema:\n\n```javascript\narr: {\n      type: 'array',\n      items: {\n        type: 'object',\n        properties: {\n          'phra\\' && console.log(42)//': {\n            type: 'number'\n          },\n          str: {\n            type: 'string'\n          }\n        }\n      }\n    }\n```\n\nobject to be stringified:\n\n```javascript\narr: [{'phra\\' && console.log(42)//': 42}]\n```",
      "automated_response": false,
      "created_at": "2019-04-12T16:59:50.836Z",
      "updated_at": "2019-04-12T16:59:50.836Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4549299,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "also, it's better to sanitize line _566_ , _855_ and _903_ in the patched `index.js`.\n\nregarding line _875_, i don't understand if it's exploitable (i keep getting syntax errors, but maybe it's possible to workaround that with [jsfuck](http://www.jsfuck.com/) or similar encoding scheme).",
      "automated_response": false,
      "created_at": "2019-04-12T17:10:05.667Z",
      "updated_at": "2019-04-12T17:24:36.946Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4550817,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Please check the following:\n\n```\ndiff --git a/index.js b/index.js\nindex b6bbe4f..a0fbbaa 100644\n--- a/index.js\n+++ b/index.js\n@@ -119,6 +119,7 @@ function build (schema, options) {\n   }\n \n   dependenciesName.push(code)\n+\n   return (Function.apply(null, dependenciesName).apply(null, dependencies))\n }\n \n@@ -301,7 +302,7 @@ function addPatternProperties (schema, externalSchema, fullSchema) {\n     }\n     var type = pp[regex].type\n     code += `\n-        if (/${regex}/.test(keys[i])) {\n+        if (/${regex.replace(/([^\\\\]+\\/)/g, '\\\\/')}/.test(keys[i])) {\n     `\n     if (type === 'object') {\n       code += buildObject(pp[regex], '', 'buildObjectPP' + index, externalSchema, fullSchema)\n@@ -491,6 +492,10 @@ function refFinder (ref, schema, externalSchema) {\n   return (new Function('schema', code))(schema)\n }\n \n+function sanitizeKey (key) {\n+  return key.replace(/([^\\\\])\\'/g, '$1\\\\\\'')\n+}\n+\n function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n   Object.keys(schema.properties || {}).forEach((key, i, a) => {\n     if (schema.properties[key]['$ref']) {\n@@ -502,12 +507,14 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     var type = schema.properties[key].type\n     var nullable = schema.properties[key].nullable\n+    var sanitized = sanitizeKey(key)\n+    var asString = sanitizeKey($asString(key))\n \n     if (nullable) {\n       code += `\n-        if (obj['${key}'] === null) {\n+        if (obj['${sanitized}'] === null) {\n           ${addComma}\n-          json += '${$asString(key)}:null'\n+          json += '${asString}:null'\n           var rendered = true\n         } else {\n       `\n@@ -515,10 +522,10 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     if (type === 'number') {\n       code += `\n-          var t = Number(obj['${key}'])\n+          var t = Number(obj['${sanitized}'])\n           if (!isNaN(t)) {\n             ${addComma}\n-            json += '${$asString(key)}:' + t\n+            json += '${asString}:' + t\n       `\n     } else if (type === 'integer') {\n       code += `\n@@ -526,25 +533,25 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n       if (isLong) {\n         code += `\n-            if (isLong(obj['${key}'])) {\n+            if (isLong(obj['${sanitized}'])) {\n               ${addComma}\n-              json += '${$asString(key)}:' + obj['${key}'].toString()\n+              json += '${asString}:' + obj['${sanitized}'].toString()\n               rendered = true\n             } else {\n-              var t = Number(obj['${key}'])\n+              var t = Number(obj['${sanitized}'])\n               if (!isNaN(t)) {\n                 ${addComma}\n-                json += '${$asString(key)}:' + t\n+                json += '${asString}:' + t\n                 rendered = true\n               }\n             }\n         `\n       } else {\n         code += `\n-            var t = Number(obj['${key}'])\n+            var t = Number(obj['${sanitized}'])\n             if (!isNaN(t)) {\n               ${addComma}\n-              json += '${$asString(key)}:' + t\n+              json += '${asString}:' + t\n               rendered = true\n             }\n         `\n@@ -554,9 +561,9 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n     } else {\n       code += `\n-        if (obj['${key}'] !== undefined) {\n+        if (obj['${sanitized}'] !== undefined) {\n           ${addComma}\n-          json += '${$asString(key)}:'\n+          json += '${asString}:'\n         `\n \n       var result = nested(laterCode, name, key, schema.properties[key], externalSchema, fullSchema)\n@@ -569,12 +576,12 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       code += `\n       } else {\n         ${addComma}\n-        json += '${$asString(key)}:${JSON.stringify(defaultValue).replace(/'/g, '\\'')}'\n+        json += '${asString}:${sanitizeKey(JSON.stringify(defaultValue)).replace(/'/g, '\\'')}'\n       `\n     } else if (schema.required && schema.required.indexOf(key) !== -1) {\n       code += `\n       } else {\n-        throw new Error('${key} is required!')\n+        throw new Error('${sanitized} is required!')\n       `\n     }\n \n@@ -845,7 +852,7 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n   var type = schema.type\n   var nullable = schema.nullable === true\n \n-  var accessor = key.indexOf('[') === 0 ? key : `['${key}']`\n+  var accessor = key.indexOf('[') === 0 ? sanitizeKey(key) : `['${sanitizeKey(key)}']`\n   switch (type) {\n     case 'null':\n       code += `\n```",
      "automated_response": false,
      "created_at": "2019-04-12T22:13:20.913Z",
      "updated_at": "2019-04-12T22:13:20.913Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4554956,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "three things:\n\n- maybe it's to sanitize line `490` in the patched `index.js`. i think it's the last user input left unsanitized.\n\n- specifying a normal property like this:\n\n```javascript\nproperties: {\n    '\"\\'w00t': {\n      type: 'string',\n      default: '\"\\'w00t'\n    },\n}\n```\n\nwill produce the following field in the JSON output:\n\n```javascript\n{\"\"'w00t\":\"\"'w00t\", ...}\n```\n\n- specifying a pattern properties like this:\n\n```javascipt\n  patternProperties: {\n    '\"\\'w00t////': {\n      type: 'number'\n    }\n  },\n``` \n\nwill remove the regex test from the generated code, instead with `\"\\'w00t` the generated check was:\n\n```diff\n- 104:        if (/\"'w00t/.test(keys[i])) {\n```\n\n",
      "automated_response": false,
      "created_at": "2019-04-13T17:53:13.967Z",
      "updated_at": "2019-04-13T17:53:13.967Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4555682,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Can you please recommend a fix for these last two problems? I'm not sure I understand, maybe a full example would help.",
      "automated_response": false,
      "created_at": "2019-04-13T22:36:44.411Z",
      "updated_at": "2019-04-13T22:36:44.411Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4557257,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "- here it is a full example for point 2:\n\n```javascript\n'use strict'\n\nconst fastJson = require('.')\nconst stringify = fastJson({\n  title: 'Example Schema',\n  type: 'object',\n  properties: {\n    '\"\\'w00t': {\n      type: 'string',\n      default: '\"\\'w00t'\n    }\n  }\n})\n\nconsole.log(stringify({}))\n```\nif we execute the script, the following invalid JSON is returned, using the latest patched `index.js`:\n\n`{\"\"'w00t\":\"\"'w00t\"}`\n\ninstead of the valid JSON:\n\n``{\"\\\"'w00t\":\"\\\"'w00t\"}``\n\n- regarding point 3, here it is a full example:\n\n```javascript\n'use strict'\n\nconst fastJson = require('.')\nconst stringify = fastJson({\n  title: 'Example Schema',\n  type: 'object',\n  properties: {\n    '\"\\'w00t': {\n      type: 'string',\n      default: '\"\\'w00t'\n    },\n },\n  patternProperties: {\n    '\"\\'w00t.*////': {\n      type: 'number'\n    }\n  }\n})\n\nconsole.log(stringify({\n  '\"\\'phra////': 42,\n  'asd': 42\n}))\n```\n\nwill produce the following JSON output, not compatible with the declared schema:\n\n`{\"\\\"'phra////\":42,\"\"'w00t\":\"\"'w00t\"}`\n\nnotice that `additionalProperty` was omitted and `asd` won't appear. however, the property named `\"\\'phra////` will appear due to a wrong regex check in the generated code. here it is a diff of the two outputs:\n\n```diff\n--- 1\t2019-04-14 12:49:15.879552362 +0200\n+++ 2\t2019-04-14 12:49:26.607563673 +0200\n@@ -88,7 +88,7 @@\n       for (var i = 0; i < keys.length; i++) {\n         if (properties[keys[i]]) continue\n   \n-        if (/\\//.test(keys[i])) {\n+        if (/\"'w00t.*/.test(keys[i])) {\n     \n           \n   if (addComma) {\n@@ -288,4 +288,4 @@\n     ;\n      return $main\n   \n-{\"\\\"'phra////\":42,\"\"'w00t\":\"\"'w00t\",\"now\":\"2019-04-14T10:49:15.884Z\"}\n+{\"\"'w00t\":\"\"'w00t\",\"now\":\"2019-04-14T10:49:26.612Z\"}\n```\n\ninstead the correct generated regex check should have been:\n\n```javascript\nif (/\"'w00t.*\\/\\/\\/\\//.test(keys[i])) {\n```",
      "automated_response": false,
      "created_at": "2019-04-14T10:57:39.091Z",
      "updated_at": "2019-04-14T11:12:24.859Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4559032,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Please try:\n\n```\ndiff --git a/index.js b/index.js\nindex b6bbe4f..e7c603c 100644\n--- a/index.js\n+++ b/index.js\n@@ -2,6 +2,7 @@\n \n var Ajv = require('ajv')\n var merge = require('deepmerge')\n+var util = require('util')\n \n // This Ajv instance is used to validate that the passed schema\n // is valid json schema. We reuse the instance to avoid having to\n@@ -301,7 +302,7 @@ function addPatternProperties (schema, externalSchema, fullSchema) {\n     }\n     var type = pp[regex].type\n     code += `\n-        if (/${regex}/.test(keys[i])) {\n+        if (/${regex.replace(/\\\\*\\//g, '\\\\/')}/.test(keys[i])) {\n     `\n     if (type === 'object') {\n       code += buildObject(pp[regex], '', 'buildObjectPP' + index, externalSchema, fullSchema)\n@@ -484,13 +485,17 @@ function refFinder (ref, schema, externalSchema) {\n       return idFinder(schema, `#${ref[1]}`)\n     } else {\n       for (var i = 1; i < walk.length; i++) {\n-        code += `['${walk[i]}']`\n+        code += `['${sanitizeKey(walk[i])}']`\n       }\n     }\n   }\n   return (new Function('schema', code))(schema)\n }\n \n+function sanitizeKey (key) {\n+  return key.replace(/([^\\\\])\\'/g, '$1\\\\\\'') // eslint-disable-line\n+}\n+\n function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n   Object.keys(schema.properties || {}).forEach((key, i, a) => {\n     if (schema.properties[key]['$ref']) {\n@@ -502,12 +507,14 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     var type = schema.properties[key].type\n     var nullable = schema.properties[key].nullable\n+    var sanitized = sanitizeKey(key)\n+    var asString = sanitizeKey($asString(key).replace(/\\\\/g, '\\\\\\\\'))\n \n     if (nullable) {\n       code += `\n-        if (obj['${key}'] === null) {\n+        if (obj['${sanitized}'] === null) {\n           ${addComma}\n-          json += '${$asString(key)}:null'\n+          json += '${asString}:null'\n           var rendered = true\n         } else {\n       `\n@@ -515,10 +522,10 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     if (type === 'number') {\n       code += `\n-          var t = Number(obj['${key}'])\n+          var t = Number(obj['${sanitized}'])\n           if (!isNaN(t)) {\n             ${addComma}\n-            json += '${$asString(key)}:' + t\n+            json += '${asString}:' + t\n       `\n     } else if (type === 'integer') {\n       code += `\n@@ -526,25 +533,25 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n       if (isLong) {\n         code += `\n-            if (isLong(obj['${key}'])) {\n+            if (isLong(obj['${sanitized}'])) {\n               ${addComma}\n-              json += '${$asString(key)}:' + obj['${key}'].toString()\n+              json += '${asString}:' + obj['${sanitized}'].toString()\n               rendered = true\n             } else {\n-              var t = Number(obj['${key}'])\n+              var t = Number(obj['${sanitized}'])\n               if (!isNaN(t)) {\n                 ${addComma}\n-                json += '${$asString(key)}:' + t\n+                json += '${asString}:' + t\n                 rendered = true\n               }\n             }\n         `\n       } else {\n         code += `\n-            var t = Number(obj['${key}'])\n+            var t = Number(obj['${sanitized}'])\n             if (!isNaN(t)) {\n               ${addComma}\n-              json += '${$asString(key)}:' + t\n+              json += '${asString}:' + t\n               rendered = true\n             }\n         `\n@@ -554,9 +561,9 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n     } else {\n       code += `\n-        if (obj['${key}'] !== undefined) {\n+        if (obj['${sanitized}'] !== undefined) {\n           ${addComma}\n-          json += '${$asString(key)}:'\n+          json += '${asString}:'\n         `\n \n       var result = nested(laterCode, name, key, schema.properties[key], externalSchema, fullSchema)\n@@ -569,12 +576,12 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       code += `\n       } else {\n         ${addComma}\n-        json += '${$asString(key)}:${JSON.stringify(defaultValue).replace(/'/g, '\\'')}'\n+        json += '${asString}:${sanitizeKey(JSON.stringify(defaultValue).replace(/\\\\/g, '\\\\\\\\'))}'\n       `\n     } else if (schema.required && schema.required.indexOf(key) !== -1) {\n       code += `\n       } else {\n-        throw new Error('${key} is required!')\n+        throw new Error('${sanitized} is required!')\n       `\n     }\n \n@@ -637,7 +644,7 @@ function addIfThenElse (schema, name, externalSchema, fullSchema) {\n   var merged = merge(copy, then)\n \n   code += `\n-    valid = ajv.validate(${require('util').inspect(i, { depth: null })}, obj)\n+    valid = ajv.validate(${util.inspect(i, { depth: null })}, obj)\n     if (valid) {\n   `\n   if (merged.if && merged.then) {\n@@ -835,6 +842,8 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n   var code = ''\n   var funcName\n \n+  subKey = subKey || ''\n+\n   if (schema.type === undefined) {\n     var inferedType = inferTypeByKeyword(schema)\n     if (inferedType) {\n@@ -845,7 +854,7 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n   var type = schema.type\n   var nullable = schema.nullable === true\n \n-  var accessor = key.indexOf('[') === 0 ? key : `['${key}']`\n+  var accessor = key.indexOf('[') === 0 ? sanitizeKey(key) : `['${sanitizeKey(key)}']`\n   switch (type) {\n     case 'null':\n       code += `\n@@ -881,7 +890,7 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n     case undefined:\n       if ('anyOf' in schema) {\n         schema.anyOf.forEach((s, index) => {\n-          var nestedResult = nested(laterCode, name, key, s, externalSchema, fullSchema, subKey !== undefined ? subKey : 'i' + index)\n+          var nestedResult = nested(laterCode, name, key, s, externalSchema, fullSchema, subKey !== '' ? subKey : 'i' + index)\n           code += `\n             ${index === 0 ? 'if' : 'else if'}(ajv.validate(${require('util').inspect(s, { depth: null })}, obj${accessor}))\n               ${nestedResult.code}\n```",
      "automated_response": false,
      "created_at": "2019-04-14T22:32:12.793Z",
      "updated_at": "2019-04-14T22:32:30.090Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4591067,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "i noticed that the current sanitize function can be bypassed with the following sequence: `\\\\\\'`\nhere is it a full poc, that will print the number 42 and produce an invalid JSON at the same time:\n\n```javascript\n'use strict'\n\nconst fastJson = require('.')\nconst stringify = fastJson({\n  title: 'Example Schema',\n  type: 'object',\n  properties: {\n    \"\\\"phra\\\\\\'&&(console.log(42))//||'phra\": {},\n  },\n})\n\nconsole.log(stringify({\n  '\"phra\\'&&(console.log(42))//||\\'phra': 42\n}))\n```",
      "automated_response": false,
      "created_at": "2019-04-18T12:01:12.452Z",
      "updated_at": "2019-04-18T12:01:12.452Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4594853,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Here is another diff:\n\n```\ndiff --git a/index.js b/index.js\nindex b6bbe4f..3f1f15c 100644\n--- a/index.js\n+++ b/index.js\n@@ -2,6 +2,7 @@\n \n var Ajv = require('ajv')\n var merge = require('deepmerge')\n+var util = require('util')\n \n // This Ajv instance is used to validate that the passed schema\n // is valid json schema. We reuse the instance to avoid having to\n@@ -301,7 +302,7 @@ function addPatternProperties (schema, externalSchema, fullSchema) {\n     }\n     var type = pp[regex].type\n     code += `\n-        if (/${regex}/.test(keys[i])) {\n+        if (/${regex.replace(/\\\\*\\//g, '\\\\/')}/.test(keys[i])) {\n     `\n     if (type === 'object') {\n       code += buildObject(pp[regex], '', 'buildObjectPP' + index, externalSchema, fullSchema)\n@@ -484,13 +485,17 @@ function refFinder (ref, schema, externalSchema) {\n       return idFinder(schema, `#${ref[1]}`)\n     } else {\n       for (var i = 1; i < walk.length; i++) {\n-        code += `['${walk[i]}']`\n+        code += `['${sanitizeKey(walk[i])}']`\n       }\n     }\n   }\n   return (new Function('schema', code))(schema)\n }\n \n+function sanitizeKey (key) {\n+  return key.replace(/\\\\*\\'/g, '\\\\\\'') // eslint-disable-line\n+}\n+\n function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n   Object.keys(schema.properties || {}).forEach((key, i, a) => {\n     if (schema.properties[key]['$ref']) {\n@@ -502,12 +507,14 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     var type = schema.properties[key].type\n     var nullable = schema.properties[key].nullable\n+    var sanitized = sanitizeKey(key)\n+    var asString = sanitizeKey($asString(key).replace(/\\\\/g, '\\\\\\\\'))\n \n     if (nullable) {\n       code += `\n-        if (obj['${key}'] === null) {\n+        if (obj['${sanitized}'] === null) {\n           ${addComma}\n-          json += '${$asString(key)}:null'\n+          json += '${asString}:null'\n           var rendered = true\n         } else {\n       `\n@@ -515,10 +522,10 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     if (type === 'number') {\n       code += `\n-          var t = Number(obj['${key}'])\n+          var t = Number(obj['${sanitized}'])\n           if (!isNaN(t)) {\n             ${addComma}\n-            json += '${$asString(key)}:' + t\n+            json += '${asString}:' + t\n       `\n     } else if (type === 'integer') {\n       code += `\n@@ -526,25 +533,25 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n       if (isLong) {\n         code += `\n-            if (isLong(obj['${key}'])) {\n+            if (isLong(obj['${sanitized}'])) {\n               ${addComma}\n-              json += '${$asString(key)}:' + obj['${key}'].toString()\n+              json += '${asString}:' + obj['${sanitized}'].toString()\n               rendered = true\n             } else {\n-              var t = Number(obj['${key}'])\n+              var t = Number(obj['${sanitized}'])\n               if (!isNaN(t)) {\n                 ${addComma}\n-                json += '${$asString(key)}:' + t\n+                json += '${asString}:' + t\n                 rendered = true\n               }\n             }\n         `\n       } else {\n         code += `\n-            var t = Number(obj['${key}'])\n+            var t = Number(obj['${sanitized}'])\n             if (!isNaN(t)) {\n               ${addComma}\n-              json += '${$asString(key)}:' + t\n+              json += '${asString}:' + t\n               rendered = true\n             }\n         `\n@@ -554,9 +561,9 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n     } else {\n       code += `\n-        if (obj['${key}'] !== undefined) {\n+        if (obj['${sanitized}'] !== undefined) {\n           ${addComma}\n-          json += '${$asString(key)}:'\n+          json += '${asString}:'\n         `\n \n       var result = nested(laterCode, name, key, schema.properties[key], externalSchema, fullSchema)\n@@ -569,12 +576,12 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       code += `\n       } else {\n         ${addComma}\n-        json += '${$asString(key)}:${JSON.stringify(defaultValue).replace(/'/g, '\\'')}'\n+        json += '${asString}:${sanitizeKey(JSON.stringify(defaultValue).replace(/\\\\/g, '\\\\\\\\'))}'\n       `\n     } else if (schema.required && schema.required.indexOf(key) !== -1) {\n       code += `\n       } else {\n-        throw new Error('${key} is required!')\n+        throw new Error('${sanitized} is required!')\n       `\n     }\n \n@@ -637,7 +644,7 @@ function addIfThenElse (schema, name, externalSchema, fullSchema) {\n   var merged = merge(copy, then)\n \n   code += `\n-    valid = ajv.validate(${require('util').inspect(i, { depth: null })}, obj)\n+    valid = ajv.validate(${util.inspect(i, { depth: null })}, obj)\n     if (valid) {\n   `\n   if (merged.if && merged.then) {\n@@ -835,6 +842,8 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n   var code = ''\n   var funcName\n \n+  subKey = subKey || ''\n+\n   if (schema.type === undefined) {\n     var inferedType = inferTypeByKeyword(schema)\n     if (inferedType) {\n@@ -845,7 +854,7 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n   var type = schema.type\n   var nullable = schema.nullable === true\n \n-  var accessor = key.indexOf('[') === 0 ? key : `['${key}']`\n+  var accessor = key.indexOf('[') === 0 ? sanitizeKey(key) : `['${sanitizeKey(key)}']`\n   switch (type) {\n     case 'null':\n       code += `\n@@ -881,7 +890,7 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n     case undefined:\n       if ('anyOf' in schema) {\n         schema.anyOf.forEach((s, index) => {\n-          var nestedResult = nested(laterCode, name, key, s, externalSchema, fullSchema, subKey !== undefined ? subKey : 'i' + index)\n+          var nestedResult = nested(laterCode, name, key, s, externalSchema, fullSchema, subKey !== '' ? subKey : 'i' + index)\n           code += `\n             ${index === 0 ? 'if' : 'else if'}(ajv.validate(${require('util').inspect(s, { depth: null })}, obj${accessor}))\n               ${nestedResult.code}\n```",
      "automated_response": false,
      "created_at": "2019-04-18T22:00:30.686Z",
      "updated_at": "2019-04-18T22:01:10.110Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4595101,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "i think we are very close, i like this patch.\nhowever there is still an edge case to manage:\n\n```javascript\n'use strict'\n\nconst fastJson = require('.')\nconst stringify = fastJson({\n  title: 'Example Schema',\n  type: 'object',\n  properties: {\n    '\"\\\\\\\\\\\\\\\\\\'w00t': {\n      type: 'string',\n      default: '\"\\'w00t'\n    }\n  }\n})\n\nconsole.log(stringify({}))\n```\n\nproduces the following JSON:\n\n`{\"\\\"'w00t\":\"\\\"'w00t\"}`\n\nbasically, all the backslashes are squashed into one.",
      "automated_response": false,
      "created_at": "2019-04-18T22:59:00.348Z",
      "updated_at": "2019-04-18T22:59:00.348Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4758566,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Can you recommend a change to the regular expression to address this? I'm low on time, and I would like to get this released asap.",
      "automated_response": false,
      "created_at": "2019-05-06T16:41:14.567Z",
      "updated_at": "2019-05-06T16:41:14.567Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4766115,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "```javascript\nfunction sanitizeKey (key) {\n  return key.replace(/\\\\*\\'/g, '\\\\\\'') // eslint-disable-line\n}\n```\n\nthis regex seems the cause of the bug:\n\n```javascript\n> \"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'asd\".replace(/\\\\*\\'/g, '\\\\\\'') // invalid output\n=> \"\\'asd\"\n> \"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'asd\".replace(/\\\\\\'/g, '\\\\\\'') // no effects, valid output\n=> \"\\\\\\\\\\\\\\'asd\"\n> \"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'asd\".replace(/\\\\\\'/g, '\\\\\\'') // no effects, valid output\n=> \"\\\\\\\\\\\\\\\\'asd\"\n> \"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'asd\".replace(/\\\\\\'/g, '\\\\\\'') // no effects, valid output\n=> \"\\\\\\\\\\\\\\\\'asd\"\n> \"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'asd\" // no effects, valid output\n=> \"\\\\\\\\\\\\\\\\'asd\"\n```\n\nthe *bugged* version protects against escaping strings delimited by `'` but produces illegal output.\nthe *fixed* version produces valid JSON because it's not changing the input, but can be exploited to escape strings delimited by `'`.\n\ni see two potential solutions:\n\n1. don't escape `'` and build only strings delimited by `\"`.\n2. use a `function` to replace the backslashes to provide a powerful replace, eg:\n\n```javascript\nfunction sanitizeKey (key) {\n  return key.replace(/\\\\*\\'/g, (str) => void 'HIC SUNT LEONES') // eslint-disable-line\n}\n```\n",
      "automated_response": false,
      "created_at": "2019-05-07T10:38:02.013Z",
      "updated_at": "2019-05-07T10:38:02.013Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4806964,
      "is_internal": false,
      "editable": false,
      "type": "Activities::BugTriaged",
      "message": "",
      "automated_response": false,
      "created_at": "2019-05-10T09:17:04.607Z",
      "updated_at": "2019-05-10T09:17:04.607Z",
      "actor": {
        "username": "beagle",
        "cleared": false,
        "verified": false,
        "url": "/beagle",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4834270,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "1. I think we would have the exact problem with `\"`, so this is not feasible.\n2. would you mind providing such a function?",
      "automated_response": false,
      "created_at": "2019-05-14T08:51:03.252Z",
      "updated_at": "2019-05-14T08:51:03.252Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4834385,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "I do not see how to produce correct output and at the same time pass:\n\n```\nconst stringify3 = build({\n  title: 'Example Schema',\n  type: 'object',\n  properties: {\n    \"\\\"phra\\\\'&&(console.log(42))//||'phra\": {}\n  }\n})\n\n// this verifies the escaping\nJSON.parse(stringify3({\n  '\"phra\\'&&(console.log(42))//||\\'phra': 42\n}))\n```",
      "automated_response": false,
      "created_at": "2019-05-14T08:56:30.419Z",
      "updated_at": "2019-05-14T08:56:30.419Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4834890,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Here is the latest patch, it fixes the last problem:\n\n\n```\ndiff --git a/index.js b/index.js\nindex b6bbe4f..f5ce493 100644\n--- a/index.js\n+++ b/index.js\n@@ -2,6 +2,7 @@\n \n var Ajv = require('ajv')\n var merge = require('deepmerge')\n+var util = require('util')\n \n // This Ajv instance is used to validate that the passed schema\n // is valid json schema. We reuse the instance to avoid having to\n@@ -301,7 +302,7 @@ function addPatternProperties (schema, externalSchema, fullSchema) {\n     }\n     var type = pp[regex].type\n     code += `\n-        if (/${regex}/.test(keys[i])) {\n+        if (/${regex.replace(/\\\\*\\//g, '\\\\/')}/.test(keys[i])) {\n     `\n     if (type === 'object') {\n       code += buildObject(pp[regex], '', 'buildObjectPP' + index, externalSchema, fullSchema)\n@@ -484,13 +485,27 @@ function refFinder (ref, schema, externalSchema) {\n       return idFinder(schema, `#${ref[1]}`)\n     } else {\n       for (var i = 1; i < walk.length; i++) {\n-        code += `['${walk[i]}']`\n+        code += `['${sanitizeKey(walk[i])}']`\n       }\n     }\n   }\n   return (new Function('schema', code))(schema)\n }\n \n+function sanitizeKey (key) {\n+  const rep = key.replace(/(\\\\*)'/g, function (match, p1) {\n+    var base = ''\n+    if (p1.length % 2 === 1) {\n+      base = p1.slice(2)\n+    } else {\n+      base = p1\n+    }\n+    var rep = base + '\\\\\\''\n+    return rep\n+  })\n+  return rep\n+}\n+\n function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n   Object.keys(schema.properties || {}).forEach((key, i, a) => {\n     if (schema.properties[key]['$ref']) {\n@@ -502,12 +517,14 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     var type = schema.properties[key].type\n     var nullable = schema.properties[key].nullable\n+    var sanitized = sanitizeKey(key)\n+    var asString = sanitizeKey($asString(key).replace(/\\\\/g, '\\\\\\\\'))\n \n     if (nullable) {\n       code += `\n-        if (obj['${key}'] === null) {\n+        if (obj['${sanitized}'] === null) {\n           ${addComma}\n-          json += '${$asString(key)}:null'\n+          json += '${asString}:null'\n           var rendered = true\n         } else {\n       `\n@@ -515,10 +532,10 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n \n     if (type === 'number') {\n       code += `\n-          var t = Number(obj['${key}'])\n+          var t = Number(obj['${sanitized}'])\n           if (!isNaN(t)) {\n             ${addComma}\n-            json += '${$asString(key)}:' + t\n+            json += '${asString}:' + t\n       `\n     } else if (type === 'integer') {\n       code += `\n@@ -526,25 +543,25 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n       if (isLong) {\n         code += `\n-            if (isLong(obj['${key}'])) {\n+            if (isLong(obj['${sanitized}'])) {\n               ${addComma}\n-              json += '${$asString(key)}:' + obj['${key}'].toString()\n+              json += '${asString}:' + obj['${sanitized}'].toString()\n               rendered = true\n             } else {\n-              var t = Number(obj['${key}'])\n+              var t = Number(obj['${sanitized}'])\n               if (!isNaN(t)) {\n                 ${addComma}\n-                json += '${$asString(key)}:' + t\n+                json += '${asString}:' + t\n                 rendered = true\n               }\n             }\n         `\n       } else {\n         code += `\n-            var t = Number(obj['${key}'])\n+            var t = Number(obj['${sanitized}'])\n             if (!isNaN(t)) {\n               ${addComma}\n-              json += '${$asString(key)}:' + t\n+              json += '${asString}:' + t\n               rendered = true\n             }\n         `\n@@ -554,9 +571,9 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       `\n     } else {\n       code += `\n-        if (obj['${key}'] !== undefined) {\n+        if (obj['${sanitized}'] !== undefined) {\n           ${addComma}\n-          json += '${$asString(key)}:'\n+          json += '${asString}:'\n         `\n \n       var result = nested(laterCode, name, key, schema.properties[key], externalSchema, fullSchema)\n@@ -569,12 +586,12 @@ function buildCode (schema, code, laterCode, name, externalSchema, fullSchema) {\n       code += `\n       } else {\n         ${addComma}\n-        json += '${$asString(key)}:${JSON.stringify(defaultValue).replace(/'/g, '\\'')}'\n+        json += '${asString}:${sanitizeKey(JSON.stringify(defaultValue).replace(/\\\\/g, '\\\\\\\\'))}'\n       `\n     } else if (schema.required && schema.required.indexOf(key) !== -1) {\n       code += `\n       } else {\n-        throw new Error('${key} is required!')\n+        throw new Error('${sanitized} is required!')\n       `\n     }\n \n@@ -637,7 +654,7 @@ function addIfThenElse (schema, name, externalSchema, fullSchema) {\n   var merged = merge(copy, then)\n \n   code += `\n-    valid = ajv.validate(${require('util').inspect(i, { depth: null })}, obj)\n+    valid = ajv.validate(${util.inspect(i, { depth: null })}, obj)\n     if (valid) {\n   `\n   if (merged.if && merged.then) {\n@@ -835,6 +852,8 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n   var code = ''\n   var funcName\n \n+  subKey = subKey || ''\n+\n   if (schema.type === undefined) {\n     var inferedType = inferTypeByKeyword(schema)\n     if (inferedType) {\n@@ -845,7 +864,7 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n   var type = schema.type\n   var nullable = schema.nullable === true\n \n-  var accessor = key.indexOf('[') === 0 ? key : `['${key}']`\n+  var accessor = key.indexOf('[') === 0 ? sanitizeKey(key) : `['${sanitizeKey(key)}']`\n   switch (type) {\n     case 'null':\n       code += `\n@@ -881,7 +900,7 @@ function nested (laterCode, name, key, schema, externalSchema, fullSchema, subKe\n     case undefined:\n       if ('anyOf' in schema) {\n         schema.anyOf.forEach((s, index) => {\n-          var nestedResult = nested(laterCode, name, key, s, externalSchema, fullSchema, subKey !== undefined ? subKey : 'i' + index)\n+          var nestedResult = nested(laterCode, name, key, s, externalSchema, fullSchema, subKey !== '' ? subKey : 'i' + index)\n           code += `\n             ${index === 0 ? 'if' : 'else if'}(ajv.validate(${require('util').inspect(s, { depth: null })}, obj${accessor}))\n               ${nestedResult.code}\ndiff --git a/test/anyof.test.js b/test/anyof.test.js\nindex afad34d..81ebdb9 100644\n--- a/test/anyof.test.js\n+++ b/test/anyof.test.js\n@@ -1,6 +1,6 @@\n 'use strict'\n \n-const test = require('tap').test\n+const { test } = require('tap')\n const build = require('..')\n \n test('object with multiple types field', (t) => {\ndiff --git a/test/sanitize.test.js b/test/sanitize.test.js\nnew file mode 100644\nindex 0000000..15cc039\n--- /dev/null\n+++ b/test/sanitize.test.js\n@@ -0,0 +1,142 @@\n+'use strict'\n+\n+const t = require('tap')\n+const build = require('..')\n+\n+const stringify = build({\n+  title: 'Example Schema',\n+  type: 'object',\n+  properties: {\n+    firstName: {\n+      type: 'string'\n+    },\n+    lastName: {\n+      type: 'string'\n+    },\n+    age: {\n+      description: 'Age in years\"',\n+      type: 'integer'\n+    },\n+    [(() => `phra'&& process.exit(1) ||'phra`)()]: {},\n+    now: {\n+      type: 'string'\n+    },\n+    reg: {\n+      type: 'string',\n+      default: 'a\\'&& process.exit(1) ||\\''\n+    },\n+    obj: {\n+      type: 'object',\n+      properties: {\n+        bool: {\n+          type: 'boolean'\n+        }\n+      }\n+    },\n+    '\"\\'w00t': {\n+      type: 'string',\n+      default: '\"\\'w00t'\n+    },\n+    arr: {\n+      type: 'array',\n+      items: {\n+        type: 'object',\n+        properties: {\n+          'phra\\' && process.exit(1)//': {\n+            type: 'number'\n+          },\n+          str: {\n+            type: 'string'\n+          }\n+        }\n+      }\n+    }\n+  },\n+  required: ['now'],\n+  patternProperties: {\n+    '.*foo$': {\n+      type: 'string'\n+    },\n+    'test': {\n+      type: 'number'\n+    },\n+    'phra\\'/ && process.exit(1) && /\\'': {\n+      type: 'number'\n+    },\n+    '\"\\'w00t.*////': {\n+      type: 'number'\n+    }\n+  },\n+  additionalProperties: {\n+    type: 'string'\n+  }\n+})\n+\n+const obj = {\n+  firstName: 'Matteo',\n+  lastName: 'Collina',\n+  age: 32,\n+  now: new Date(),\n+  foo: 'hello\"',\n+  bar: \"world'\",\n+  'fuzz\"': 42,\n+  \"me'\": 42,\n+  numfoo: 42,\n+  test: 42,\n+  strtest: '23',\n+  arr: [{ 'phra\\' && process.exit(1)//': 42 }],\n+  obj: { bool: true },\n+  notmatch: 'valar morghulis',\n+  notmatchobj: { a: true },\n+  notmatchnum: 42\n+}\n+\n+// pass if it does not crash\n+const json = stringify(obj)\n+JSON.parse(json)\n+\n+const stringify2 = build({\n+  title: 'Example Schema',\n+  type: 'object',\n+  patternProperties: {\n+    '\"\\'w00t.*////': {\n+      type: 'number'\n+    }\n+  }\n+})\n+\n+t.deepEqual(JSON.parse(stringify2({\n+  '\"\\'phra////': 42,\n+  'asd': 42\n+})), {\n+})\n+\n+const stringify3 = build({\n+  title: 'Example Schema',\n+  type: 'object',\n+  properties: {\n+    \"\\\"phra\\\\'&&(console.log(42))//||'phra\": {}\n+  }\n+})\n+\n+// this verifies the escaping\n+JSON.parse(stringify3({\n+  '\"phra\\'&&(console.log(42))//||\\'phra': 42\n+}))\n+\n+const stringify4 = build({\n+  title: 'Example Schema',\n+  type: 'object',\n+  properties: {\n+    '\"\\\\\\\\\\\\\\\\\\'w00t': {\n+      type: 'string',\n+      default: '\"\\'w00t'\n+    }\n+  }\n+})\n+\n+t.deepEqual(JSON.parse(stringify4({})), {\n+  '\"\\\\\\\\\\\\\\\\\\'w00t': '\"\\'w00t'\n+})\n+\n+t.pass('no crashes')\n```",
      "automated_response": false,
      "created_at": "2019-05-14T09:44:04.450Z",
      "updated_at": "2019-05-14T09:44:04.450Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4836040,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "it looks fixed to me.\n+1 to implement unit tests covering the cases reported in this thread in order to prevent any future regression and avoid breaking changes due to this patch.",
      "automated_response": false,
      "created_at": "2019-05-14T13:32:03.341Z",
      "updated_at": "2019-05-14T13:32:03.341Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4940185,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "PR in https://github.com/fastify/fast-json-stringify/pull/168.",
      "automated_response": false,
      "created_at": "2019-05-28T11:10:20.366Z",
      "updated_at": "2019-05-28T11:10:20.366Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4940450,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Released as v1.15.3.",
      "automated_response": false,
      "created_at": "2019-05-28T12:12:54.972Z",
      "updated_at": "2019-05-28T12:12:54.972Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 4954806,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "can we mark this as _Resolved_ ?",
      "automated_response": false,
      "created_at": "2019-05-30T15:08:31.325Z",
      "updated_at": "2019-05-30T15:08:31.325Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5064273,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "any update?",
      "automated_response": false,
      "created_at": "2019-06-12T10:28:23.374Z",
      "updated_at": "2019-06-12T10:28:23.374Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5064300,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "I'm +1 in considering this resolved. I'm -1 on treating this as a vulnerability, mainly because we do not aim to guarantee that fast-json-stringify is safe to use with user data.",
      "automated_response": false,
      "created_at": "2019-06-12T10:34:08.896Z",
      "updated_at": "2019-06-12T10:34:08.896Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5106964,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Catching up on this now.\n\n@mcollina it seems like `fast-json-stringify` is not going to guarantee security concerns due to the dynamic evaluation and serialization nature of how it works. So a developer directly choosing to use `fast-json-stringify` should be aware of it and read the docs which mention it. However, `fastify` makes use of this library \"behind the scenes\" and the user may not be aware that such security concerns are valid if they provide a schema. If to make the matter more confusing for developers, the framework states `Developer friendly: the framework is built to be very expressive and help the developer in their daily use, without sacrificing performance and security.` which may hint developers that they don't need to perform anything special in terms of security where-as it seems that the real advice from you is that developers should definitely be concerned as to the data they provide through the `schema` capability because that could turn into code injection.\n\nWould that sum it up correctly?\nIf so, instead of this being a vulnerability in `fastify`, perhaps we should add a note to the project's page about the use of `schema` and its security concerns?",
      "automated_response": false,
      "created_at": "2019-06-16T10:50:21.327Z",
      "updated_at": "2019-06-16T10:50:21.327Z",
      "actor": {
        "username": "lirantal",
        "cleared": false,
        "verified": false,
        "url": "/lirantal",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5112083,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "@lirantal the security part of that statetment is based on the following threat model:\n\n1. we provide one of the fastest data validator (Ajv) embedded in the framework. Validating your data is a must-have, and this does increase application security.\n2. using fast-json-stringify improves unexpected data leaks, as only the properties in the schema are sent.\n3. we do not allow routes to be defined at runtime (after listen). As a result it's not possible to exploit this from a route. Developers try to do this all the time, and we prevent them from it.\n4. some other bits and bobs within the framework.\n\nData validation is application code. If you load application code from untrusted sources, you have to worry about a lot of things, and so is data validation. Note that the same reasoning applies to Ajv, see https://www.npmjs.com/package/ajv#security-considerations.\n\nNote that there is _already_ a disclaimer for this, so I do not think there is anything more to add: https://github.com/fastify/fastify/blob/master/docs/Validation-and-Serialization.md#--security-notice. Let me know if you think that sentence is not enough, but it seems pretty clear to me.",
      "automated_response": false,
      "created_at": "2019-06-17T10:23:39.676Z",
      "updated_at": "2019-06-17T10:23:39.676Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5112466,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Completely agree, thanks for pointing out the details.\nI missed that validation-specific doc at https://github.com/fastify/fastify/blob/master/docs/Validation-and-Serialization.md but now that you pointed it out I'm ok with this notice.\n\nI'm ok to resolve as-is (no CVE and no PRing to the security-wg repo as this is not a security vulnerability).\n",
      "automated_response": false,
      "created_at": "2019-06-17T11:23:23.856Z",
      "updated_at": "2019-06-17T11:23:23.856Z",
      "actor": {
        "username": "lirantal",
        "cleared": false,
        "verified": false,
        "url": "/lirantal",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5112470,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "@phra any strong objections?",
      "automated_response": false,
      "created_at": "2019-06-17T11:24:02.447Z",
      "updated_at": "2019-06-17T11:24:02.447Z",
      "actor": {
        "username": "lirantal",
        "cleared": false,
        "verified": false,
        "url": "/lirantal",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5112672,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Hi @lirantal , thanks for joining the conversation. I have some points that I would like to mention:\n\n1. First of all, I want to point out that adding a *security disclaimer* to a README doesn't declass a code injection to something else. Instead, we worked together to patch the source code in order to prevent injections by design, effectively patching the reported vulnerability. Moreover, the *security disclaimer* was added _one week later_ this report was sent, proving the value of this responsible disclosure, as you can see from this commit https://github.com/fastify/fastify/commit/a387f0575bab4f3077c374faab680e30931e4036\n\n2. The vulnerability itself lived in `fast-json-stringify` and `fastify` is just using that library. I agree that the issue cannot be exploited remotely against any `fastify` web server, but the problem here is that `fast-json-stringify` is a generic library and can be used in other ways compared to `fastify` use case.\n\n3. I have read the Ajv security considerations but it only states about DoS-like attacks, such as slowing down the performance of the application if untrusted data is passed into the schema definition. They also implemented a *meta schema* (https://github.com/epoberezkin/ajv/blob/master/lib/refs/json-schema-secure.json) in order to validate it at runtime. Anyway I see that they use `new Function()` too, so I am going to play with it to understand it better.\n\nSaid that, IMHO I agree to change the asset of this report from `fastify` to `fast-json-stringify` (3rd party modules maybe?) but I don't agree on considering this **now patched** code injection as something different that a security risk.",
      "automated_response": false,
      "created_at": "2019-06-17T12:21:10.453Z",
      "updated_at": "2019-06-17T12:21:10.453Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5112807,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "The following is the most important sentence of Ajv threat model:\n\n> Ajv treats JSON schemas as trusted as your application code. \n\nBefore this issue, this was not covered in Fastify docs, and in https://github.com/fastify/fastify/commit/a387f0575bab4f3077c374faab680e30931e4036 we fixed it. This was a direct result of this issue, and we are grateful.\n\nWe are happy to include this info in some other places in the docs.\n\n---\n\nThe fastify team does not want to consider fast-json-stringify safe to use with untrusted data, nor it consider Ajv safe to use with untrusted data. It's a guarantee that is exceptionally hard to make and maintain, and there are unlimited amount of ways this could go wrong. Moreover, Ajv do not provide that guarantee, and we validate every schema coming in with the same meta model Ajv is using. Therefore, we never spent the time hardening against this, mainly because it was not supposed to be used that way. \n \nConsidering it a vulnerability would essentially assume that the team consider it as such and offer such a guarantee. Simply we don't, and we do not plan to. As my experience with all security issues on the Node core team, it is way better to not declare a CVE for something that is just user misuse, because then you immediately become a target for security researcher that try to break escaping/etc. User misuse is just user misuse.\n\nI think it's a good thing to patch, but using new Function with untrusted data is just _too risky_, as it could always be possible to break escaping.",
      "automated_response": false,
      "created_at": "2019-06-17T12:47:20.699Z",
      "updated_at": "2019-06-17T12:47:20.699Z",
      "actor": {
        "username": "mcollina",
        "cleared": false,
        "verified": false,
        "url": "/mcollina",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/230/980/61a26e6fa4ec002fca494b3b7b43aa251eef3453_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5135874,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "@phra it is easy to take reports like yours for granted so I want to take the opportunity to thank you for all the effort in putting this report up, working with Matteo and working with us to discuss the issue. Your involvement here doesn't go un-noticed and is immensely appreciated ❤️ and I have no doubt Matteo feels the same way.\n\nI will clarify why I think the security issue here in itself is not a security issue for `fast-json-stringify` - this library may handle untrusted data and by consequence \"bad things\" can happen. For example, consider Node.js's child_process API - you could argue that it has some methods that are vulnerable to command injection but the purpose of the API is not to be ultimately secure but rather to provide access to OS process APIs and it is up to the developer using this API to use it wisely as much as they can. I see `fast-json-stringify` falling in this same spot and this is why I think that this report in first place is correctly geared towards `fastify` the framework and not that module specifically.\n\nAs to `fastify`, I can make similar arguments or comparison with say React's dangerouslySetInnerHTML API which may turn code injection into XSS if not used properly and there's no CVE or vulnerability in the React framework due to that. In the same way, I feel that `fastify` falls in this place as well. The project recognizes the fact that the schema you provide is entirely under your (the developer's) control and ownership and its their responsibility to clean/sanitize/validate/etc before using it.\n\nI find triaging security vulnerabilities a tricky business and I understand how this topic can be very border line between vulnerability, bug, and project policies. Regardless I'm happy to continue discussing and learn if you still feel strongly about this being a security vulnerability.\n\nJust to say again with all sincerity that your work is tremendously appreciated and has already contributed to many improvements in the projects we're discussing ❤️\n",
      "automated_response": false,
      "created_at": "2019-06-19T12:14:42.844Z",
      "updated_at": "2019-06-19T12:14:42.844Z",
      "actor": {
        "username": "lirantal",
        "cleared": false,
        "verified": false,
        "url": "/lirantal",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5597053,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "can you please mark this as _Resolved_ ?",
      "automated_response": false,
      "created_at": "2019-08-17T11:54:13.020Z",
      "updated_at": "2019-08-17T11:54:13.020Z",
      "actor": {
        "username": "phra",
        "cleared": false,
        "verified": false,
        "url": "/phra",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/201/213/71f68147b3cb0e1d6e7e39953fc2c4822d04d338_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5721446,
      "is_internal": false,
      "editable": false,
      "type": "Activities::Comment",
      "message": "Sincere apologies for the late response, I'll resolve right away!",
      "automated_response": false,
      "created_at": "2019-09-03T18:16:12.290Z",
      "updated_at": "2019-09-03T18:16:12.290Z",
      "actor": {
        "username": "lirantal",
        "cleared": false,
        "verified": false,
        "url": "/lirantal",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5721451,
      "is_internal": false,
      "editable": false,
      "type": "Activities::BugResolved",
      "message": "Valuable feedback has been provided and incorporated in the form of security improvements to open source library fast-json-stringify. Thank you!",
      "automated_response": false,
      "created_at": "2019-09-03T18:16:47.285Z",
      "updated_at": "2019-09-03T18:16:47.285Z",
      "actor": {
        "username": "lirantal",
        "cleared": false,
        "verified": false,
        "url": "/lirantal",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "reporter": {
        "username": "phra",
        "url": "/phra"
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5721460,
      "is_internal": false,
      "editable": false,
      "type": "Activities::AgreedOnGoingPublic",
      "message": "",
      "automated_response": false,
      "created_at": "2019-09-03T18:17:32.445Z",
      "updated_at": "2019-09-03T18:17:32.445Z",
      "first_to_agree": true,
      "actor": {
        "username": "lirantal",
        "cleared": false,
        "verified": false,
        "url": "/lirantal",
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/096/045/7e9d9170c9862d8d3697b11b0bb7160d40444c16_original.jpeg/fd3465a1d18de709ef6a7a4daaffea9f69b778e9708be2cc15159c7bef911a89"
        },
        "hackerone_triager": false,
        "hackerone_employee": false
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 5953782,
      "is_internal": false,
      "editable": false,
      "type": "Activities::ReportBecamePublic",
      "message": "",
      "automated_response": false,
      "created_at": "2019-10-03T18:17:41.784Z",
      "updated_at": "2019-10-03T18:17:41.784Z",
      "actor": {
        "url": "/nodejs-ecosystem",
        "ibb": false,
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
        },
        "profile": {
          "name": "Node.js third-party modules"
        }
      },
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem"
    },
    {
      "id": 6468824,
      "is_internal": false,
      "editable": false,
      "type": "Activities::BountyAwarded",
      "message": "@phra notice that you are eligible for bounties now that we have that supported. Thank you for sending this report and for your time!",
      "automated_response": false,
      "created_at": "2019-12-04T20:15:08.007Z",
      "updated_at": "2019-12-04T20:15:08.007Z",
      "actor": {
        "url": "/nodejs-ecosystem",
        "ibb": false,
        "profile_picture_urls": {
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
        },
        "profile": {
          "name": "Node.js third-party modules"
        }
      },
      "bounty_currency": "usd",
      "genius_execution_id": null,
      "team_handle": "nodejs-ecosystem",
      "collaborator": {
        "username": "phra",
        "url": "/phra"
      }
    }
  ],
  "activity_page_count": 1,
  "activity_page_number": 1,
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}